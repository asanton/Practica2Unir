---


  - name: Instalacion operador Tigera
    command: kubectl create -f "{{ tigera_url }}"


  - name: Obtencion fichero definicion Calico
    command:
         cmd: wget "{{ calico_url }}"
         warn: no


  - name: Configuracion Calico con CIDR personalizada
    lineinfile:
        path: ./custom-resources.yaml
        line: "{{item}}"
        state: present
        create: yes
    with_items:
       - "# This section includes base Calico installation configuration."
       - "# For more information, see: https://docs.projectcalico.org/v3.17/reference/installation/api#operator.tigera.io/v1.Installation"
       - "apiVersion: operator.tigera.io/v1"
       - "kind: Installation"
       - "metadata:"
       - "  name: default"
       - "spec:"
       - "  # Configures Calico networking."
       - "  calicoNetwork:"
       - "    # Note: The ipPools section cannot be modified post-install."
       - "    ipPools:"
       - "    - blockSize: 26"
       - "      cidr: {{ PODs_red }}"
       - "      encapsulation: VXLANCrossSubnet"
       - "      natOutgoing: Enabled"
       - "      nodeSelector: all()"


  - name: Instalacion Calico
    command: kubectl apply -f custom-resources.yaml




